<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Comparison Engine</title>
    <style>
        :root { --primary: #0f172a; --accent: #3b82f6; --bg: #f1f5f9; --train: #16a34a; --flight: #ea580c; }
        body { background: var(--bg); color: var(--primary); font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        
        /* Header */
        header { text-align: center; margin-bottom: 40px; }
        header h1 { font-size: 2.5em; margin-bottom: 10px; background: -webkit-linear-gradient(#3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Input Form */
        .form-section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; }
        #submitBtn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        #submitBtn:hover { background: #334155; }

        /* Comparison Logic Styling */
        .segment-card { background: white; border-radius: 16px; margin-bottom: 40px; overflow: hidden; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        
        .segment-header { position: relative; height: 200px; }
        .city-img { width: 100%; height: 100%; object-fit: cover; }
        .segment-title { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; padding: 20px; }
        .segment-title h2 { margin: 0; font-size: 1.8em; }

        /* The VS Battle Table */
        .comparison-box { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; }
        
        .option-card { background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; position: relative; }
        .option-card.train { border-left: 5px solid var(--train); }
        .option-card.flight { border-left: 5px solid var(--flight); }

        .option-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; font-weight: bold; font-size: 1.1em; }
        .icon { font-size: 1.2em; }
        
        .badge { position: absolute; top: 10px; right: 10px; font-size: 0.75em; padding: 4px 8px; border-radius: 4px; color: white; font-weight: bold; }
        .badge.cheap { background: var(--train); }
        .badge.fast { background: var(--flight); }

        .detail-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9em; color: #64748b; }
        .detail-val { color: var(--primary); font-weight: 600; }

        /* Itinerary Styling */
        .itinerary-section { padding: 20px; }
        .day-block { margin-bottom: 15px; padding-left: 15px; border-left: 3px solid #cbd5e1; }
        .day-title { font-weight: bold; color: var(--accent); margin-bottom: 10px; }
        .activity-item { display: flex; justify-content: space-between; font-size: 0.95em; margin-bottom: 5px; }

        .loading { display: none; text-align: center; padding: 40px; color: #64748b; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>‚ö° Rail vs Air</h1>
        <p>The Intelligent Comparison Engine</p>
    </header>

    <div class="form-section">
        <form id="tripForm">
            <div class="form-grid">
                <input type="text" id="origin" placeholder="Start: Kolkata" required>
                <input type="text" id="destination" placeholder="Destinations: Varanasi, Delhi" required>
                <input type="number" id="days" value="5" placeholder="Days">
                <select id="budget">
                    <option>Budget-friendly</option>
                    <option>Moderate</option>
                    <option>Luxury</option>
                </select>
                <select id="currency">
                    <option value="INR">INR (‚Çπ)</option>
                    <option value="USD">USD ($)</option>
                </select>
            </div>
            <button type="submit" id="submitBtn">Compare Routes & Plan Trip</button>
        </form>
    </div>

    <div class="loading" id="loading">‚ú® Analyzing 140+ Train Routes and Flight paths...</div>

    <div id="results"></div>
</div>

<script>
    const getImg = (keyword) => `https://loremflickr.com/800/400/${keyword.split(' ')[0]},travel?random=${Math.random()}`;

    document.getElementById('tripForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const loader = document.getElementById('loading');
        const results = document.getElementById('results');
        
        btn.disabled = true;
        loader.style.display = 'block';
        results.innerHTML = '';

        try {
            const res = await fetch('/api/plan-trip', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    origin: document.getElementById('origin').value,
                    destination: document.getElementById('destination').value,
                    days: document.getElementById('days').value,
                    budget: document.getElementById('budget').value,
                    currency: document.getElementById('currency').value
                })
            });

            const data = await res.json();
            
            // Render Segments
            if (data.segments) {
                results.innerHTML = data.segments.map(seg => {
                    const t = seg.transport_comparison.train;
                    const f = seg.transport_comparison.flight;
                    
                    return `
                    <div class="segment-card">
                        <div class="segment-header">
                            <img src="${getImg(seg.image_keyword)}" class="city-img">
                            <div class="segment-title">
                                <h2>${seg.from} ‚ûî ${seg.to}</h2>
                            </div>
                        </div>

                        <div class="comparison-box">
                            <div class="option-card train">
                                <span class="badge cheap">Option A: The Rail Experience</span>
                                <div class="option-header"><span class="icon">üöÜ</span> ${t.name}</div>
                                <div class="detail-row"><span>3AC Fare</span> <span class="detail-val">${t.fare_3ac}</span></div>
                                <div class="detail-row"><span>2AC Fare</span> <span class="detail-val">${t.fare_2ac}</span></div>
                                <div class="detail-row"><span>Time</span> <span class="detail-val">${t.duration}</span></div>
                            </div>

                            <div class="option-card flight">
                                <span class="badge fast">Option B: The Air Shortcut</span>
                                <div class="option-header"><span class="icon">‚úàÔ∏è</span> ${f.practical ? 'Flight' : 'Not Recommended'}</div>
                                ${f.practical ? `
                                    <div class="detail-row"><span>Type</span> <span class="detail-val">${f.details}</span></div>
                                    <div class="detail-row"><span>Fare</span> <span class="detail-val">${f.fare}</span></div>
                                    <div class="detail-row"><span>Total Time</span> <span class="detail-val">${f.duration}</span></div>
                                ` : `<p style="color:#64748b; font-size:0.9em;">Distance < 400km. Rail/Road is faster.</p>`}
                            </div>
                        </div>

                        <div class="itinerary-section">
                            ${seg.itinerary_days.map(day => `
                                <div class="day-block">
                                    <div class="day-title">Day ${day.day_number}: ${day.theme}</div>
                                    ${day.activities.map(act => `
                                        <div class="activity-item">
                                            <span>${act.time}: ${act.desc}</span>
                                            <strong>${act.cost}</strong>
                                        </div>
                                    `).join('')}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `}).join('');
            }

        } catch (err) {
            alert(err.message);
        } finally {
            loader.style.display = 'none';
            btn.disabled = false;
        }
    });
</script>
</body>
</html>
        const cleanKeyword = keyword.split(' ')[0]; // Use first word for better hits
        return `https://loremflickr.com/800/400/${cleanKeyword},travel,landmark?random=${Math.random()}`;
    };

    document.getElementById('tripForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const loader = document.getElementById('loading');
        const results = document.getElementById('results');
        
        btn.disabled = true;
        loader.style.display = 'block';
        results.style.display = 'none';

        try {
            const res = await fetch('/api/plan-trip', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    origin: document.getElementById('origin').value,
                    destination: document.getElementById('destination').value,
                    days: document.getElementById('days').value,
                    budget: document.getElementById('budget').value,
                    transport: document.getElementById('transport').value,
                    currency: document.getElementById('currency').value,
                    type: 'multi'
                })
            });

            const data = await res.json();
            if (data.error) throw new Error(data.error);

            // 1. Show Optimized Route
            const routeDiv = document.getElementById('routeSummary');
            if(data.optimized_route_order && data.optimized_route_order.length > 0) {
                routeDiv.style.display = 'block';
                routeDiv.innerHTML = `üöÄ Optimized Route: ${data.optimized_route_order.join(' ‚ûî ')}`;
            } else {
                routeDiv.style.display = 'none';
            }

            // 2. Render Itinerary
            const container = document.getElementById('itineraryList');
            container.innerHTML = data.itinerary.map(day => `
                <div class="day-card">
                    <img src="${getRealImg(day.image_keyword)}" class="city-banner" loading="lazy" alt="${day.city}">
                    <div class="day-header">
                        <h3>Day ${day.day}: ${day.city}</h3>
                        <p>${day.theme}</p>
                    </div>
                    <div class="activities">
                        ${day.activities.map(act => `
                            <div class="activity-row">
                                <img src="${getRealImg(act.image_keyword)}" class="act-img" loading="lazy">
                                <div class="act-details">
                                    <span class="time-badge">${act.time}</span>
                                    <span class="cost-badge">${act.cost}</span>
                                    <p><strong>${act.activity}</strong></p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            document.getElementById('totalCost').innerText = data.total_cost;
            results.style.display = 'block';

        } catch (err) {
            alert("Error: " + err.message);
        } finally {
            loader.style.display = 'none';
            btn.disabled = false;
        }
    });
</script>
</body>
</html>
