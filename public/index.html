<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Travel Planner</title>
    <style>
        :root { --primary: #2563eb; --secondary: #1e40af; --bg: #f8fafc; --text: #0f172a; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; }
        
        header { text-align: center; margin-bottom: 40px; }
        header h1 { color: var(--primary); margin-bottom: 5px; font-size: 2.5em; }
        
        .form-section { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0; font-size: 1em; box-sizing: border-box; }
        input:focus, select:focus { outline: 2px solid var(--primary); border-color: transparent; }
        label { font-size: 0.85em; font-weight: bold; color: #64748b; display: block; margin-bottom: 6px; }

        #submitBtn { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: 0.2s; }
        #submitBtn:hover { background: var(--secondary); }
        #submitBtn:disabled { background: #cbd5e1; cursor: not-allowed; }

        /* Results */
        .route-summary { background: #dbeafe; color: var(--secondary); padding: 15px; border-radius: 8px; margin: 30px 0; font-weight: bold; text-align: center; display: none; }

        .day-card { background: white; border-radius: 16px; overflow: hidden; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        
        /* City Banner Image */
        .city-banner { width: 100%; height: 220px; object-fit: cover; background: #eee; }
        
        .day-header { padding: 20px; background: white; border-bottom: 1px solid #f1f5f9; }
        .day-header h3 { margin: 0; color: var(--primary); font-size: 1.4em; }

        .activities { padding: 0 20px 20px 20px; }
        .activity-row { display: flex; gap: 15px; border-bottom: 1px solid #f1f5f9; padding: 20px 0; }
        .activity-row:last-child { border-bottom: none; }

        /* Activity Thumbnail */
        .act-img { width: 90px; height: 90px; border-radius: 12px; object-fit: cover; background: #f1f5f9; flex-shrink: 0; }
        
        .act-details { flex-grow: 1; }
        .time-badge { display: inline-block; background: #e0f2fe; color: var(--primary); padding: 4px 10px; border-radius: 20px; font-size: 0.8em; font-weight: bold; margin-bottom: 5px; }
        .cost-badge { float: right; color: #f59e0b; font-weight: bold; font-size: 1.1em; }

        .loading { display: none; text-align: center; margin: 50px; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üåç Global Tour Planner</h1>
        <p>Real Routes & Real Photos</p>
    </header>
    
    <div class="form-section">
        <form id="tripForm">
            <div class="form-grid">
                <div><label>Start From</label><input type="text" id="origin" placeholder="e.g. Kolkata" required></div>
                <div><label>Destinations</label><input type="text" id="destination" placeholder="e.g. Vrindavan, Jaipur" required></div>
                <div><label>Days</label><input type="number" id="days" value="5" min="1" max="30"></div>
                <div>
                    <label>Transport</label>
                    <select id="transport">
                        <option>Flight</option>
                        <option>Train</option>
                        <option>Car</option>
                    </select>
                </div>
            </div>
            <div class="form-grid">
                <div>
                    <label>Budget</label>
                    <select id="budget">
                        <option>Moderate</option>
                        <option>Budget-friendly</option>
                        <option>Luxury</option>
                    </select>
                </div>
                <div>
                    <label>Currency</label>
                    <select id="currency">
                        <option value="INR">INR (‚Çπ)</option>
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (‚Ç¨)</option>
                    </select>
                </div>
            </div>

            <button type="submit" id="submitBtn">Generate Plan</button>
        </form>
    </div>

    <div class="loading" id="loading">
        <h2>‚ú® AI is finding the best route and photos...</h2>
    </div>

    <div id="results" style="display:none;">
        <div class="route-summary" id="routeSummary"></div>
        <div id="itineraryList"></div>
        <h2 id="totalCost" style="text-align:right; color:#f59e0b; margin-top:20px;"></h2>
    </div>
</div>

<script>
    // Retrieves a real image from Flickr using a keyword
    const getRealImg = (keyword) => {
        // 'loremflickr' is a free service that serves stock photos based on keywords
        // We add 'travel,landmark' to ensure the photos are relevant
        const cleanKeyword = keyword.split(' ')[0]; // Use first word for better hits
        return `https://loremflickr.com/800/400/${cleanKeyword},travel,landmark?random=${Math.random()}`;
    };

    document.getElementById('tripForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const loader = document.getElementById('loading');
        const results = document.getElementById('results');
        
        btn.disabled = true;
        loader.style.display = 'block';
        results.style.display = 'none';

        try {
            const res = await fetch('/api/plan-trip', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    origin: document.getElementById('origin').value,
                    destination: document.getElementById('destination').value,
                    days: document.getElementById('days').value,
                    budget: document.getElementById('budget').value,
                    transport: document.getElementById('transport').value,
                    currency: document.getElementById('currency').value,
                    type: 'multi'
                })
            });

            const data = await res.json();
            if (data.error) throw new Error(data.error);

            // 1. Show Optimized Route
            const routeDiv = document.getElementById('routeSummary');
            if(data.optimized_route_order && data.optimized_route_order.length > 0) {
                routeDiv.style.display = 'block';
                routeDiv.innerHTML = `üöÄ Optimized Route: ${data.optimized_route_order.join(' ‚ûî ')}`;
            } else {
                routeDiv.style.display = 'none';
            }

            // 2. Render Itinerary
            const container = document.getElementById('itineraryList');
            container.innerHTML = data.itinerary.map(day => `
                <div class="day-card">
                    <img src="${getRealImg(day.image_keyword)}" class="city-banner" loading="lazy" alt="${day.city}">
                    <div class="day-header">
                        <h3>Day ${day.day}: ${day.city}</h3>
                        <p>${day.theme}</p>
                    </div>
                    <div class="activities">
                        ${day.activities.map(act => `
                            <div class="activity-row">
                                <img src="${getRealImg(act.image_keyword)}" class="act-img" loading="lazy">
                                <div class="act-details">
                                    <span class="time-badge">${act.time}</span>
                                    <span class="cost-badge">${act.cost}</span>
                                    <p><strong>${act.activity}</strong></p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            document.getElementById('totalCost').innerText = data.total_cost;
            results.style.display = 'block';

        } catch (err) {
            alert("Error: " + err.message);
        } finally {
            loader.style.display = 'none';
            btn.disabled = false;
        }
    });
</script>
</body>
</html>
