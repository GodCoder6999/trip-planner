<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trip Planner</title>
    <style>
        :root { --primary: #2563eb; --secondary: #1e40af; --bg: #f8fafc; --text: #1e293b; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 20px; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* Header */
        header { text-align: center; margin-bottom: 30px; }
        header h1 { color: var(--primary); margin-bottom: 5px; }
        
        /* Form Section */
        .form-section { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        
        /* Mode Tabs */
        .tabs { display: flex; justify-content: center; margin-bottom: 25px; gap: 10px; }
        .tab-btn { padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer; font-weight: 600; background: #e2e8f0; color: #64748b; transition: 0.2s; }
        .tab-btn.active { background: var(--primary); color: white; }

        /* Grid Layout */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .full-width { grid-column: span 2; }
        
        /* Inputs */
        label { font-size: 0.9em; font-weight: 600; color: #64748b; display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0; font-size: 1em; box-sizing: border-box; }
        input:focus, select:focus { outline: 2px solid var(--primary); border-color: transparent; }

        /* Multi City Specifics */
        .multi-wrapper { display: flex; gap: 10px; width: 100%; }
        #cityInput { flex-grow: 1; }
        .btn-add { 
            background: var(--primary); color: white; border: none; 
            padding: 0 20px; border-radius: 8px; font-weight: bold; cursor: pointer;
            white-space: nowrap; 
        }
        .btn-add:hover { background: var(--secondary); }

        .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; min-height: 30px; }
        .chip { background: #e0f2fe; color: var(--primary); padding: 5px 12px; border-radius: 15px; font-size: 0.9em; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .chip:hover { background: #bae6fd; }

        /* Submit Button */
        #submitBtn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #submitBtn:hover { background: var(--secondary); }
        #submitBtn:disabled { background: #ccc; cursor: not-allowed; }

        /* Results */
        .loading { display: none; text-align: center; margin: 40px; color: var(--primary); font-weight: bold; }
        .result-box { display: none; margin-top: 30px; }
        .total-cost { text-align: right; font-size: 1.5em; font-weight: bold; color: #f59e0b; margin-bottom: 20px; }
        
        .day-card { background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .day-card h3 { margin-top: 0; color: var(--primary); }
        .activity { display: flex; justify-content: space-between; border-bottom: 1px solid #f1f5f9; padding: 12px 0; }
        .activity:last-child { border-bottom: none; }
        .activity-time { font-weight: bold; color: #64748b; min-width: 80px; }
        .activity-cost { font-weight: bold; color: #f59e0b; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>AI Trip Planner</h1>
        <p>Your smart travel companion</p>
    </header>
    
    <div class="form-section">
        <div class="tabs">
            <button onclick="setMode('single')" class="tab-btn active" id="btnSingle">Single City</button>
            <button onclick="setMode('multi')" class="tab-btn" id="btnMulti">Multi-City</button>
        </div>

        <form id="tripForm">
            <div class="form-grid">
                <div>
                    <label>Starting From</label>
                    <input type="text" id="origin" placeholder="e.g. New York" required>
                </div>
                
                <div id="singleDest">
                    <label>Destination</label>
                    <input type="text" id="dest" placeholder="e.g. Paris">
                </div>

                <div id="multiDest" style="display:none;" class="full-width">
                    <label>Destinations (Add at least 2)</label>
                    <div class="multi-wrapper">
                        <input type="text" id="cityInput" placeholder="Type city name...">
                        <button type="button" class="btn-add" onclick="addCity()">Add +</button>
                    </div>
                    <div class="chips" id="chips"></div>
                </div>

                <div>
                    <label>Duration (Days)</label>
                    <input type="number" id="days" value="5" min="1" max="30" required>
                </div>
                <div>
                    <label>Currency</label>
                    <select id="currency">
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (€)</option>
                        <option value="INR">INR (₹)</option>
                        <option value="GBP">GBP (£)</option>
                    </select>
                </div>
                <div>
                    <label>Budget Style</label>
                    <select id="budget">
                        <option>Moderate</option>
                        <option>Budget-friendly</option>
                        <option>Luxury</option>
                    </select>
                </div>
                <div>
                    <label>Transport Mode</label>
                    <select id="transport">
                        <option>Flight</option>
                        <option>Train</option>
                        <option>Bus</option>
                        <option>Car</option>
                    </select>
                </div>
            </div>

            <button type="submit" id="submitBtn">Generate My Plan</button>
        </form>
    </div>

    <div class="loading" id="loading">
        <p>✨ AI is analyzing routes and prices...</p>
    </div>

    <div class="result-box" id="results">
        <div class="total-cost" id="totalCost"></div>
        <div id="itinerary"></div>
    </div>
</div>

<script>
    let cities = [];
    let currentMode = 'single';

    // Toggle between Single and Multi city modes
    function setMode(mode) {
        currentMode = mode;
        
        // Update UI visibility
        document.getElementById('singleDest').style.display = mode === 'single' ? 'block' : 'none';
        document.getElementById('multiDest').style.display = mode === 'multi' ? 'block' : 'none';
        
        // Update Tab Styles
        document.getElementById('btnSingle').className = mode === 'single' ? 'tab-btn active' : 'tab-btn';
        document.getElementById('btnMulti').className = mode === 'multi' ? 'tab-btn active' : 'tab-btn';

        // Toggle Required attribute
        document.getElementById('dest').required = (mode === 'single');
    }

    // Add city to list
    function addCity() {
        const input = document.getElementById('cityInput');
        const val = input.value.trim();
        if (val && !cities.includes(val)) {
            cities.push(val);
            renderChips();
            input.value = '';
        }
    }

    // Render the little city bubbles
    function renderChips() {
        const div = document.getElementById('chips');
        div.innerHTML = cities.map(c => `
            <span class="chip" onclick="removeCity('${c}')">
                ${c} ✕
            </span>
        `).join('');
    }

    window.removeCity = (c) => {
        cities = cities.filter(x => x !== c);
        renderChips();
    };

    // Handle Form Submit
    document.getElementById('tripForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Logic to get the correct destination string
        const dest = currentMode === 'single' ? document.getElementById('dest').value : cities.join(', ');
        
        // Basic Validation
        if (!dest) {
            alert(currentMode === 'single' ? "Please enter a destination" : "Please add at least 2 cities");
            return;
        }
        if (currentMode === 'multi' && cities.length < 2) {
            alert("For Multi-City trips, please add at least 2 destinations.");
            return;
        }

        // Show Loading
        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').style.display = 'none';
        document.getElementById('submitBtn').disabled = true;
        document.getElementById('submitBtn').textContent = "Planning...";

        try {
            // CALLING YOUR BACKEND
            // Note: We use the relative path '/api/plan-trip'. 
            // Vercel automatically routes this to your api/index.js file.
            const res = await fetch('/api/plan-trip', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    origin: document.getElementById('origin').value,
                    destination: dest,
                    days: document.getElementById('days').value,
                    budget: document.getElementById('budget').value,
                    transport: document.getElementById('transport').value,
                    currency: document.getElementById('currency').value,
                    type: currentMode
                })
            });

            const data = await res.json();
            
            if (data.error) throw new Error(data.error);

            // Render Results
            document.getElementById('totalCost').innerText = data.total_cost || "Cost Calculated";
            
            document.getElementById('itinerary').innerHTML = data.itinerary.map(day => `
                <div class="day-card">
                    <h3>Day ${day.day}: ${day.location ? day.location + ' - ' : ''}${day.theme}</h3>
                    ${day.activities.map(act => `
                        <div class="activity">
                            <div>
                                <span class="activity-time">${act.time}</span>
                                <span>${act.activity}</span>
                            </div>
                            <span class="activity-cost">${act.cost}</span>
                        </div>
                    `).join('')}
                </div>
            `).join('');
            
            document.getElementById('results').style.display = 'block';

        } catch (err) {
            console.error(err);
            alert("Error: " + err.message);
        } finally {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submitBtn').textContent = "Generate My Plan";
        }
    });
</script>
</body>
</html>