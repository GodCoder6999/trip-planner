<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trip Planner</title>
    <style>
        :root { --primary: #2563eb; --secondary: #1e40af; --bg: #f8fafc; --text: #1e293b; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* Form Styling */
        .form-section { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .full-width { grid-column: span 2; }
        
        input, select, button { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0; margin-top: 5px; }
        button { cursor: pointer; font-weight: bold; background: var(--primary); color: white; border: none; }
        button:hover { background: var(--secondary); }
        button:disabled { background: #ccc; }

        /* Multi City Input */
        .multi-wrapper { display: flex; gap: 10px; }
        .btn-add { width: auto; white-space: nowrap; }
        .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .chip { background: #e0f2fe; color: var(--primary); padding: 5px 12px; border-radius: 15px; font-size: 0.9em; cursor: pointer; }

        /* Results */
        .result-box { display: none; margin-top: 30px; }
        .day-card { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .activity { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 10px 0; }
        .loading { display: none; text-align: center; margin: 20px; font-weight: bold; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: var(--primary);">AI Trip Planner</h1>
    
    <div class="form-section">
        <div style="text-align:center; margin-bottom:20px;">
            <button onclick="setMode('single')" id="btnSingle">Single City</button>
            <button onclick="setMode('multi')" id="btnMulti" style="background:#e2e8f0; color:#64748b;">Multi-City</button>
        </div>

        <form id="tripForm">
            <input type="hidden" id="mode" value="single">
            
            <div class="form-grid">
                <div>
                    <label>From</label>
                    <input type="text" id="origin" placeholder="New York" required>
                </div>
                
                <div id="singleDest">
                    <label>To</label>
                    <input type="text" id="dest" placeholder="Paris">
                </div>

                <div id="multiDest" style="display:none;" class="full-width">
                    <label>Destinations</label>
                    <div class="multi-wrapper">
                        <input type="text" id="cityInput" placeholder="Add city...">
                        <button type="button" class="btn-add" onclick="addCity()">Add +</button>
                    </div>
                    <div class="chips" id="chips"></div>
                </div>

                <div>
                    <label>Days</label>
                    <input type="number" id="days" value="5" min="1" max="30" required>
                </div>
                <div>
                    <label>Currency</label>
                    <select id="currency">
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (€)</option>
                        <option value="INR">INR (₹)</option>
                    </select>
                </div>
                <div>
                    <label>Budget</label>
                    <select id="budget">
                        <option>Moderate</option>
                        <option>Budget-friendly</option>
                        <option>Luxury</option>
                    </select>
                </div>
                <div>
                    <label>Transport</label>
                    <select id="transport">
                        <option>Flight</option>
                        <option>Train</option>
                        <option>Car</option>
                    </select>
                </div>
            </div>

            <button type="submit" id="submitBtn">Generate Plan</button>
        </form>
    </div>

    <div class="loading" id="loading">✨ AI is planning your trip... please wait...</div>

    <div class="result-box" id="results">
        <h2 id="totalCost"></h2>
        <div id="itinerary"></div>
    </div>
</div>

<script>
    let cities = [];
    let currentMode = 'single';

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('mode').value = mode;
        document.getElementById('singleDest').style.display = mode === 'single' ? 'block' : 'none';
        document.getElementById('multiDest').style.display = mode === 'multi' ? 'block' : 'none';
        
        document.getElementById('btnSingle').style.background = mode === 'single' ? '#2563eb' : '#e2e8f0';
        document.getElementById('btnSingle').style.color = mode === 'single' ? 'white' : '#64748b';
        document.getElementById('btnMulti').style.background = mode === 'multi' ? '#2563eb' : '#e2e8f0';
        document.getElementById('btnMulti').style.color = mode === 'multi' ? 'white' : '#64748b';
    }

    function addCity() {
        const input = document.getElementById('cityInput');
        const val = input.value.trim();
        if (val && !cities.includes(val)) {
            cities.push(val);
            renderChips();
            input.value = '';
        }
    }

    function renderChips() {
        const div = document.getElementById('chips');
        div.innerHTML = cities.map(c => `<span class="chip" onclick="removeCity('${c}')">${c} ✕</span>`).join('');
    }

    window.removeCity = (c) => {
        cities = cities.filter(x => x !== c);
        renderChips();
    };

    document.getElementById('tripForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const dest = currentMode === 'single' ? document.getElementById('dest').value : cities.join(', ');
        if (!dest) return alert("Please enter a destination");

        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').style.display = 'none';
        document.getElementById('submitBtn').disabled = true;

        try {
            // This is the key part: connecting to your backend instead of asking for a key
            const res = await fetch('/api/plan-trip', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    origin: document.getElementById('origin').value,
                    destination: dest,
                    days: document.getElementById('days').value,
                    budget: document.getElementById('budget').value,
                    transport: document.getElementById('transport').value,
                    currency: document.getElementById('currency').value,
                    type: currentMode
                })
            });

            const data = await res.json();
            if (data.error) throw new Error(data.error);

            document.getElementById('totalCost').innerText = data.total_cost;
            document.getElementById('itinerary').innerHTML = data.itinerary.map(day => `
                <div class="day-card">
                    <h3>Day ${day.day}: ${day.location || ''} - ${day.theme}</h3>
                    ${day.activities.map(act => `
                        <div class="activity">
                            <span><strong>${act.time}:</strong> ${act.activity}</span>
                            <strong>${act.cost}</strong>
                        </div>
                    `).join('')}
                </div>
            `).join('');
            
            document.getElementById('results').style.display = 'block';

        } catch (err) {
            alert(err.message);
        } finally {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('submitBtn').disabled = false;
        }
    });
</script>
</body>
</html>